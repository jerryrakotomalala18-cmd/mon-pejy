<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivie Livraison - Comp√©tition 24 Places</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        h1, h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        .btn-danger {
            background: #f56565;
            color: white;
        }
        
        .btn-secondary {
            background: #718096;
            color: white;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: normal;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            overflow: hidden;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* MEMBRES LIST */
        .membres-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .membre-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .membre-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .membre-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            margin: 0 auto 15px;
            overflow: hidden;
            border: 4px solid #667eea;
        }
        
        .membre-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .membre-sigle {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .membre-nom {
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .membre-equipe {
            font-size: 12px;
            color: #666;
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .nav-tab {
            flex: 1;
            padding: 12px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .nav-tab.active {
            background: #667eea;
            color: white;
        }
        
        .competition-banner {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .competition-banner h2 {
            color: white;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .places-counter {
            font-size: 48px;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .places-full {
            background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%);
        }
        
        .places-warning {
            background: linear-gradient(135deg, #ffa94d 0%, #fd7e14 100%);
        }
        
        .leaderboard {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .leaderboard-title {
            text-align: center;
            color: #667eea;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            background: #f8f9fa;
            transition: all 0.3s;
        }
        
        .leaderboard-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .rank {
            font-size: 24px;
            font-weight: bold;
            width: 50px;
            text-align: center;
        }
        
        .rank-1 {
            color: #ffd700;
            font-size: 32px;
        }
        
        .rank-2 {
            color: #c0c0c0;
            font-size: 28px;
        }
        
        .rank-3 {
            color: #cd7f32;
            font-size: 26px;
        }
        
        .medal {
            font-size: 32px;
            margin-right: 10px;
        }
        
        .leader-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            margin-right: 15px;
            overflow: hidden;
        }
        
        .leader-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .leader-info {
            flex: 1;
        }
        
        .leader-name {
            font-weight: bold;
            font-size: 18px;
            color: #333;
        }
        
        .leader-equipe {
            font-size: 14px;
            color: #666;
        }
        
        .leader-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .stat-badge {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .livraison-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }
        
        .livraison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .livraison-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .livraison-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            overflow: hidden;
        }
        
        .livraison-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .livraison-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .info-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
        }
        
        .info-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 3px;
        }
        
        .info-value {
            font-weight: bold;
            color: #333;
        }
        
        .livraison-actions {
            display: flex;
            gap: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .like-btn {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            color: #666;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .like-btn:hover {
            background: #f0f0f0;
        }
        
        .like-btn.liked {
            color: #e53e3e;
            font-weight: bold;
        }
        
        .comments-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .comment {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .comment-author {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .comment-text {
            color: #333;
            font-size: 14px;
        }
        
        .comment-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .comment-input {
            flex: 1;
        }
        
        .stats {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat-item h3 {
            font-size: 32px;
            margin-bottom: 5px;
        }
        
        .stat-item p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .type-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .type-interne {
            background: #bee3f8;
            color: #2c5282;
        }
        
        .type-externe {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .form-add-livraison {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            font-size: 14px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alert-success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #48bb78;
        }
        
        .alert-error {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #f56565;
        }
        
        .alert-warning {
            background: #feebc8;
            color: #7c2d12;
            border-left: 4px solid #f59e0b;
        }
        
        .top-3-highlight {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- PAGE LOGIN -->
        <div id="loginPage" class="page active">
            <div class="card" style="max-width: 500px; margin: 50px auto;">
                <h1>üîê ESPACE MEMBRES</h1>
                <div id="loginAlert"></div>
                
                <h3 style="color: #667eea; text-align: center; margin: 20px 0;">üë• Nos Membres</h3>
                <div class="membres-grid" id="membresGrid"></div>
                
                <div style="text-align: center; margin: 30px 0;">
                    <hr style="margin: 20px 0;">
                    <p style="color: #666;">Pas encore membre ?</p>
                    <button class="btn btn-success" onclick="showRegister()" style="margin-top: 10px;">‚ú® S'inscrire maintenant</button>
                </div>
            </div>
        </div>

        <!-- PAGE INSCRIPTION -->
        <div id="registerPage" class="page">
            <div class="card" style="max-width: 600px; margin: 50px auto;">
                <h1>üìù INSCRIPTION</h1>
                <div id="registerAlert"></div>
                <div class="form-group">
                    <label>SIGLE *</label>
                    <input type="text" id="regSigle" placeholder="Ex: JRA">
                </div>
                <div class="form-group">
                    <label>Mot de passe *</label>
                    <input type="password" id="regPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="form-group">
                    <label>Nom complet *</label>
                    <input type="text" id="regNom" placeholder="Ex: Jean Rakoto">
                </div>
                <div class="form-group">
                    <label>√âquipe *</label>
                    <input type="text" id="regEquipe" placeholder="Ex: Team A">
                </div>
                <div class="form-group">
                    <label>T√©l√©phone</label>
                    <input type="tel" id="regTel" placeholder="Ex: 034 00 000 00">
                </div>
                <div class="form-group">
                    <label>Sexe</label>
                    <div class="radio-group">
                        <label><input type="radio" name="sexe" value="H" checked> Homme</label>
                        <label><input type="radio" name="sexe" value="F"> Femme</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Mode de travail</label>
                    <div class="radio-group">
                        <label><input type="radio" name="mode" value="INTERNE" checked> Interne</label>
                        <label><input type="radio" name="mode" value="EXTERNE"> Externe</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Photo de profil</label>
                    <input type="file" id="photoUpload" accept="image/*" onchange="previewPhoto()">
                    <div id="photoPreview" style="margin-top: 10px; text-align: center;"></div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="register()">Valider</button>
                    <button class="btn btn-secondary" onclick="showLogin()">Retour</button>
                </div>
            </div>
        </div>

        <!-- PAGE DASHBOARD -->
        <div id="dashboardPage" class="page">
            <div class="header">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">?</div>
                    <div>
                        <h3 id="userName">Utilisateur</h3>
                        <p style="color: #666; font-size: 14px;" id="userEquipe">√âquipe</p>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="logout()">üö™ D√©connexion</button>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('general')">üåç G√âN√âRAL</button>
                <button class="nav-tab" onclick="showTab('suivi')">üìä MON SUIVI</button>
            </div>

            <!-- TAB G√âN√âRAL -->
            <div id="tabGeneral" class="tab-content active">
                <div class="competition-banner" id="competitionBanner">
                    <h2>üèÜ COMP√âTITION 24 PLACES üèÜ</h2>
                    <p style="font-size: 18px;">Izay be EQH no VOALOHANY!</p>
                    <div class="places-counter" id="placesCounter">24/24</div>
                    <p id="placesText">Places disponibles</p>
                </div>

                <div class="leaderboard">
                    <div class="leaderboard-title">üèÖ CLASSEMENT G√âN√âRAL üèÖ</div>
                    <div id="leaderboardList"></div>
                </div>

                <div class="card form-add-livraison">
                    <h2>üì¶ Nouvelle Livraison</h2>
                    <div id="addAlert"></div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Slot *</label>
                            <input type="text" id="slotInput" placeholder="Ex: SLOT001FAC">
                        </div>
                        <div class="form-group">
                            <label>EQH *</label>
                            <input type="number" id="eqhInput" step="0.1" min="0" placeholder="Ex: 2.5">
                        </div>
                        <div class="form-group">
                            <label>Date Livraison *</label>
                            <input type="date" id="dateLivraison">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Type de travail</label>
                        <div class="radio-group">
                            <label><input type="radio" name="typeTravail" value="INTERNE" checked> INTERNE</label>
                            <label><input type="radio" name="typeTravail" value="EXTERNE"> EXTERNE</label>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="ajouterLivraison()">üì¶ Ajouter Livraison</button>
                    </div>
                </div>

                <h2 style="color: white; text-align: center; margin-bottom: 20px;">üéØ Toutes les Livraisons (24 derni√®res)</h2>
                <div id="livraisonsList"></div>
            </div>

            <!-- TAB SUIVI -->
            <div id="tabSuivi" class="tab-content">
                <div class="stats">
                    <div class="stat-item">
                        <h3 id="totalEQH">0</h3>
                        <p>Total EQH</p>
                    </div>
                    <div class="stat-item">
                        <h3 id="totalSalaire">0 Ar</h3>
                        <p>Salaire Total</p>
                    </div>
                    <div class="stat-item">
                        <h3 id="myRank">-</h3>
                        <p>Mon Rang</p>
                    </div>
                </div>

                <h2 style="color: white; text-align: center; margin-bottom: 20px;">üìã Mes Livraisons</h2>
                <div id="suiviList"></div>
            </div>

            <div class="footer">
                üìã By Jerry Rakotomalala - Version Comp√©tition 2025
            </div>
        </div>
    </div>

    <script>
        const MAX_LIVRAISONS = 24;
        let users = [];
        let livraisons = [];
        let currentUser = null;
        let photoData = null;

        // CHARGEMENT ET SAUVEGARDE
        function loadData() {
            const savedUsers = localStorage.getItem('users');
            const savedLivraisons = localStorage.getItem('livraisons');
            
            if (savedUsers) users = JSON.parse(savedUsers);
            if (savedLivraisons) livraisons = JSON.parse(savedLivraisons);
        }

        function saveData() {
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('livraisons', JSON.stringify(livraisons));
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('dateLivraison');
            if (dateInput) dateInput.value = today;
            afficherMembres();
        });

        function previewPhoto() {
            const fileInput = document.getElementById('photoUpload');
            const preview = document.getElementById('photoPreview');
            
            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    photoData = e.target.result;
                    preview.innerHTML = `<img src="${photoData}" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #667eea;">`;
                };
                
                reader.readAsDataURL(fileInput.files[0]);
            }
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function showLogin() {
            showPage('loginPage');
            document.getElementById('loginAlert').innerHTML = '';
            afficherMembres();
        }

        function showRegister() {
            showPage('registerPage');
            document.getElementById('registerAlert').innerHTML = '';
        }

        function showDashboard() {
            showPage('dashboardPage');
            showTab('general');
            updateDashboard();
        }

        function showTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            
            if (tabName === 'general') {
                document.getElementById('tabGeneral').classList.add('active');
            } else {
                document.getElementById('tabSuivi').classList.add('active');
                updateSuivi();
            }
        }

        // AFFICHER MEMBRES SUR LOGIN PAGE
        function afficherMembres() {
            const grid = document.getElementById('membresGrid');
            
            if (users.length === 0) {
                grid.innerHTML = '<p style="text-align:center;color:#666;grid-column: 1/-1;">Aucun membre pour le moment. Soyez le premier √† vous inscrire!</p>';
                return;
            }
            
            grid.innerHTML = users.map(user => {
                const avatarContent = user.photo 
                    ? `<img src="${user.photo}" alt="${user.nom}">`
                    : user.sigle[0];
                
                return `
                    <div class="membre-card" onclick="loginAsMembre(${user.id})">
                        <div class="membre-avatar">${avatarContent}</div>
                        <div class="membre-sigle">${user.sigle}</div>
                        <div class="membre-nom">${user.nom}</div>
                        <div class="membre-equipe">${user.equipe}</div>
                    </div>
                `;
            }).join('');
        }

        function loginAsMembre(userId) {
            const password = prompt('Entrez votre mot de passe:');
            if (!password) return;
            
            const user = users.find(u => u.id === userId && u.password === password);
            
            if (user) {
                currentUser = user;
                showDashboard();
            } else {
                alert('‚ùå Mot de passe incorrect!');
            }
        }

        function register() {
            const sigle = document.getElementById('regSigle').value.trim().toUpperCase();
            const password = document.getElementById('regPassword').value;
            const nom = document.getElementById('regNom').value.trim();
            const equipe = document.getElementById('regEquipe').value.trim();
            const tel = document.getElementById('regTel').value.trim();
            const sexe = document.querySelector('input[name="sexe"]:checked').value;
            const mode = document.querySelector('input[name="mode"]:checked').value;

            if (!sigle || !password || !nom || !equipe) {
                showAlert('registerAlert', 'Veuillez remplir tous les champs obligatoires', 'error');
                return;
            }

            if (users.find(u => u.sigle === sigle)) {
                showAlert('registerAlert', 'Ce SIGLE existe d√©j√†', 'error');
                return;
            }

            const user = {
                id: Date.now(),
                sigle,
                password,
                nom,
                equipe,
                tel,
                sexe,
                mode,
                photo: photoData || null
            };

            users.push(user);
            saveData();
            showAlert('registerAlert', '‚úÖ Inscription r√©ussie! Vous pouvez maintenant vous connecter.', 'success');
            
            photoData = null;
            document.getElementById('photoPreview').innerHTML = '';
            
            setTimeout(() => {
                showLogin();
            }, 1500);
        }

        function logout() {
            currentUser = null;
            showLogin();
        }

        function getWeekNumber(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7));
            const yearStart = new Date(d.getFullYear(), 0, 1);
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function calculerSalaire(slot, eqh, typeTravail) {
            const isFacile = slot.toLowerCase().includes('fac');
            const isDifficile = slot.toLowerCase().includes('dif');
            
            let tarif = 0;
            
            if (isFacile) {
                tarif = typeTravail === 'INTERNE' ? 2350 : 2850;
            } else if (isDifficile) {
                tarif = typeTravail === 'INTERNE' ? 3350 : 3850;
            } else {
                tarif = typeTravail === 'INTERNE' ? 2350 : 2850;
            }
            
            return eqh * tarif;
        }

        function ajouterLivraison() {
            if (!currentUser) return;

            if (livraisons.length >= MAX_LIVRAISONS) {
                showAlert('addAlert', '‚ö†Ô∏è Les 24 places sont COMPL√àTES! Impossible d\'ajouter plus de livraisons.', 'error');
                return;
            }

            const slot = document.getElementById('slotInput').value.trim();
            const eqh = parseFloat(document.getElementById('eqhInput').value);
            const dateLivraison = document.getElementById('dateLivraison').value;
            const typeTravail = document.querySelector('input[name="typeTravail"]:checked').value;

            if (!slot || !eqh || !dateLivraison) {
                showAlert('addAlert', 'Veuillez remplir tous les champs', 'error');
                return;
            }

            if (eqh <= 0) {
                showAlert('addAlert', 'EQH doit √™tre sup√©rieur √† 0', 'error');
                return;
            }

            const semaine = getWeekNumber(dateLivraison);
            const salaire = calculerSalaire(slot, eqh, typeTravail);

            const livraison = {
                id: Date.now(),
                userId: currentUser.id,
                userNom: currentUser.nom,
                userSigle: currentUser.sigle,
                userPhoto: currentUser.photo,
                slot,
                eqh,
                dateLivraison,
                semaine,
                typeTravail,
                salaire,
                dateCreation: new Date().toLocaleString('fr-FR'),
                likes: [],
                comments: []
            };

            livraisons.unshift(livraison);
            
            if (livraisons.length > MAX_LIVRAISONS) {
                livraisons = livraisons.slice(0, MAX_LIVRAISONS);
            }
            
            saveData();
            
            const placesRestantes = MAX_LIVRAISONS - livraisons.length;
            let msg = `‚úÖ Livraison ajout√©e! Salaire: ${salaire.toFixed(0)} Ar\n`;
            msg += `üìä Places restantes: ${placesRestantes}/${MAX_LIVRAISONS}`;
            
            showAlert('addAlert', msg, 'success');
            
            document.getElementById('slotInput').value = '';
            document.getElementById('eqhInput').value = '';
            
            updateDashboard();
        }

        function calculateLeaderboard() {
            const userStats = {};
            
            users.forEach(user => {
                userStats[user.id] = {
                    user: user,
                    totalEQH: 0,
                    totalSalaire: 0,
                    nombreLivraisons: 0
                };
            });
            
            livraisons.forEach(liv => {
                if (userStats[liv.userId]) {
                    userStats[liv.userId].totalEQH += liv.eqh;
                    userStats[liv.userId].totalSalaire += liv.salaire;
                    userStats[liv.userId].nombreLivraisons++;
                }
            });
            
            return Object.values(userStats)
                .filter(stat => stat.nombreLivraisons > 0)
                .sort((a, b) => b.totalEQH - a.totalEQH);
        }

        function updateLeaderboard() {
            const leaderboard = calculateLeaderboard();
            const container = document.getElementById('leaderboardList');
            
            if (leaderboard.length === 0) {
                container.innerHTML = '<p style="text-align:center;color:#666;">Aucun classement pour le moment</p>';
                return;
            }
            
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            
            container.innerHTML = leaderboard.map((stat, index) => {
                const rank = index + 1;
                const isTop3 = rank <= 3;
                const medal = medals[index] || '';
                const rankClass = `rank-${rank}`;
                const highlightClass = isTop3 ? 'top-3-highlight' : '';
                
                const avatarContent = stat.user.photo 
                    ? `<img src="${stat.user.photo}" alt="Photo">`
                    : stat.user.sigle[0];
                
                return `
                    <div class="leaderboard-item ${highlightClass}">
                        ${medal ? `<span class="medal">${medal}</span>` : ''}
                        <div class="rank ${isTop3 ? rankClass : ''}">#${rank}</div>
                        <div class="leader-avatar">${avatarContent}</div>
                        <div class="leader-info">
                            <div class="leader-name">${stat.user.nom}</div>
                            <div class="leader-equipe">${stat.user.equipe}</div>
                        </div>
                        <div class="leader-stats">
                            <span class="stat-badge">‚ö° ${stat.totalEQH.toFixed(1)} EQH</span>
                            <span class="stat-badge">üí∞ ${stat.totalSalaire.toFixed(0)} Ar</span>
                            <span class="stat-badge">üì¶ ${stat.nombreLivraisons}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateCompetitionBanner() {
            const placesRestantes = MAX_LIVRAISONS - livraisons.length;
            const banner = document.getElementById('competitionBanner');
            const counter = document.getElementById('placesCounter');
            const text = document.getElementById('placesText');
            
            counter.textContent = `${placesRestantes}/${MAX_LIVRAISONS}`;
            
            if (placesRestantes === 0) {
                banner.className = 'competition-banner places-full';
                text.textContent = 'üî¥ PLACES COMPL√àTES! Comp√©tition termin√©e!';
            } else if (placesRestantes <= 5) {
                banner.className = 'competition-banner places-warning';
                text.textContent = '‚ö†Ô∏è ATTENTION! Places bient√¥t compl√®tes!';
            } else {
                banner.className = 'competition-banner';
                text.textContent = 'Places disponibles - D√©p√™chez-vous!';
            }
        }

        function updateDashboard() {
            if (!currentUser) return;

            document.getElementById('userName').textContent = currentUser.nom;
            document.getElementById('userEquipe').textContent = currentUser.equipe;
            
            const avatarEl = document.getElementById('userAvatar');
            if (currentUser.photo) {
                avatarEl.innerHTML = `<img src="${currentUser.photo}" alt="Photo">`;
            } else {
                avatarEl.innerHTML = currentUser.sigle[0];
            }

            const mesLivraisons = livraisons.filter(l => l.userId === currentUser.id);
            const totalEQH = mesLivraisons.reduce((sum, l) => sum + l.eqh, 0);
            const totalSalaire = mesLivraisons.reduce((sum, l) => sum + l.salaire, 0);

            document.getElementById('totalEQH').textContent = totalEQH.toFixed(1);
            document.getElementById('totalSalaire').textContent = totalSalaire.toFixed(0) + ' Ar';
            
            const leaderboard = calculateLeaderboard();
            const myRank = leaderboard.findIndex(stat => stat.user.id === currentUser.id) + 1;
            document.getElementById('myRank').textContent = myRank > 0 ? `#${myRank}` : '-';

            updateLeaderboard();
            updateCompetitionBanner();
            afficherLivraisons();
        }

        function updateSuivi() {
            if (!currentUser) return;
            
            const container = document.getElementById('suiviList');
            const mesLivraisons = livraisons.filter(l => l.userId === currentUser.id);
            
            if (mesLivraisons.length === 0) {
                container.innerHTML = '<div class="card"><p style="text-align:center;color:#666;">Vous n\'avez pas encore de livraison</p></div>';
                return;
            }

            container.innerHTML = mesLivraisons.map(liv => {
                const avatarContent = liv.userPhoto 
                    ? `<img src="${liv.userPhoto}" alt="Photo">`
                    : liv.userSigle[0];
                
                return `
                <div class="livraison-card">
                    <div class="livraison-header">
                        <div class="livraison-user">
                            <div class="livraison-avatar">${avatarContent}</div>
                            <div>
                                <strong>${liv.userNom}</strong>
                                <div style="font-size: 12px; color: #666;">${liv.dateCreation}</div>
                            </div>
                        </div>
                        <span class="type-badge type-${liv.typeTravail.toLowerCase()}">${liv.typeTravail}</span>
                    </div>

                    <div class="livraison-info">
                        <div class="info-item">
                            <div class="info-label">üìã Slot</div>
                            <div class="info-value">${liv.slot}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">‚ö° EQH</div>
                            <div class="info-value">${liv.eqh}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üì¶ Livraison</div>
                            <div class="info-value">${new Date(liv.dateLivraison).toLocaleDateString('fr-FR')}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üìÖ Semaine</div>
                            <div class="info-value">S${liv.semaine}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üí∞ Salaire</div>
                            <div class="info-value">${liv.salaire.toFixed(0)} Ar</div>
                        </div>
                    </div>

                    <div class="livraison-actions">
                        <button class="like-btn ${liv.likes.includes(currentUser.id) ? 'liked' : ''}" onclick="toggleLike(${liv.id})">
                            ${liv.likes.includes(currentUser.id) ? '‚ù§Ô∏è' : 'ü§ç'} ${liv.likes.length} J'aime
                        </button>
                        <button class="like-btn" onclick="toggleComments(${liv.id})">
                            üí¨ ${liv.comments.length} Commentaires
                        </button>
                    </div>

                    <div class="comments-section" id="comments-${liv.id}" style="display: none;">
                        <div id="commentsList-${liv.id}">
                            ${liv.comments.map(c => `
                                <div class="comment">
                                    <div class="comment-author">${c.userName}</div>
                                    <div class="comment-text">${c.text}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="comment-form">
                            <input type="text" class="comment-input" id="commentInput-${liv.id}" placeholder="Ajouter un commentaire...">
                            <button class="btn btn-primary" onclick="addComment(${liv.id})">Envoyer</button>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        function afficherLivraisons() {
            const container = document.getElementById('livraisonsList');
            
            if (livraisons.length === 0) {
                container.innerHTML = '<div class="card"><p style="text-align:center;color:#666;">Aucune livraison pour le moment</p></div>';
                return;
            }

            container.innerHTML = livraisons.map(liv => {
                const avatarContent = liv.userPhoto 
                    ? `<img src="${liv.userPhoto}" alt="Photo">`
                    : liv.userSigle[0];
                
                return `
                <div class="livraison-card">
                    <div class="livraison-header">
                        <div class="livraison-user">
                            <div class="livraison-avatar">${avatarContent}</div>
                            <div>
                                <strong>${liv.userNom}</strong>
                                <div style="font-size: 12px; color: #666;">${liv.dateCreation}</div>
                            </div>
                        </div>
                        <span class="type-badge type-${liv.typeTravail.toLowerCase()}">${liv.typeTravail}</span>
                    </div>

                    <div class="livraison-info">
                        <div class="info-item">
                            <div class="info-label">üìã Slot</div>
                            <div class="info-value">${liv.slot}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">‚ö° EQH</div>
                            <div class="info-value">${liv.eqh}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üì¶ Livraison</div>
                            <div class="info-value">${new Date(liv.dateLivraison).toLocaleDateString('fr-FR')}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üìÖ Semaine</div>
                            <div class="info-value">S${liv.semaine}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üí∞ Salaire</div>
                            <div class="info-value">${liv.salaire.toFixed(0)} Ar</div>
                        </div>
                    </div>

                    <div class="livraison-actions">
                        <button class="like-btn ${liv.likes.includes(currentUser.id) ? 'liked' : ''}" onclick="toggleLike(${liv.id})">
                            ${liv.likes.includes(currentUser.id) ? '‚ù§Ô∏è' : 'ü§ç'} ${liv.likes.length} J'aime
                        </button>
                        <button class="like-btn" onclick="toggleComments(${liv.id})">
                            üí¨ ${liv.comments.length} Commentaires
                        </button>
                    </div>

                    <div class="comments-section" id="comments-${liv.id}" style="display: none;">
                        <div id="commentsList-${liv.id}">
                            ${liv.comments.map(c => `
                                <div class="comment">
                                    <div class="comment-author">${c.userName}</div>
                                    <div class="comment-text">${c.text}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="comment-form">
                            <input type="text" class="comment-input" id="commentInput-${liv.id}" placeholder="Ajouter un commentaire...">
                            <button class="btn btn-primary" onclick="addComment(${liv.id})">Envoyer</button>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        function toggleLike(livId) {
            const liv = livraisons.find(l => l.id === livId);
            if (!liv) return;

            const index = liv.likes.indexOf(currentUser.id);
            if (index > -1) {
                liv.likes.splice(index, 1);
            } else {
                liv.likes.push(currentUser.id);
            }

            saveData();
            afficherLivraisons();
            if (document.getElementById('tabSuivi').classList.contains('active')) {
                updateSuivi();
            }
        }

        function toggleComments(livId) {
            const commentsDiv = document.getElementById(`comments-${livId}`);
            commentsDiv.style.display = commentsDiv.style.display === 'none' ? 'block' : 'none';
        }

        function addComment(livId) {
            const input = document.getElementById(`commentInput-${livId}`);
            const text = input.value.trim();
            
            if (!text) return;

            const liv = livraisons.find(l => l.id === livId);
            if (!liv) return;

            liv.comments.push({
                userName: currentUser.nom,
                text: text
            });

            saveData();
            input.value = '';
            afficherLivraisons();
            if (document.getElementById('tabSuivi').classList.contains('active')) {
                updateSuivi();
            }
            toggleComments(livId);
            setTimeout(() => toggleComments(livId), 100);
        }

        function showAlert(elementId, message, type) {
            const alertClass = type === 'success' ? 'alert-success' : (type === 'warning' ? 'alert-warning' : 'alert-error');
            document.getElementById(elementId).innerHTML = `
                <div class="alert ${alertClass}">${message}</div>
            `;
            
            setTimeout(() => {
                document.getElementById(elementId).innerHTML = '';
            }, 5000);
        }

        // Initialisation avec donn√©es test
        if (users.length === 0) {
            users.push({
                id: 1,
                sigle: 'ADMIN',
                password: '1234',
                nom: 'Jerry Rakotomalala',
                equipe: 'Team Admin',
                tel: '034 00 000 00',
                sexe: 'H',
                mode: 'INTERNE',
                photo: null
            });
            
            users.push({
                id: 2,
                sigle: 'JRA',
                password: '1234',
                nom: 'Jean Rakoto',
                equipe: 'Team A',
                tel: '034 11 111 11',
                sexe: 'H',
                mode: 'EXTERNE',
                photo: null
            });
            
            users.push({
                id: 3,
                sigle: 'MRA',
                password: '1234',
                nom: 'Marie Rasoa',
                equipe: 'Team B',
                tel: '034 22 222 22',
                sexe: 'F',
                mode: 'INTERNE',
                photo: null
            });
            
            saveData();
        }
    </script>
</body>
</html>